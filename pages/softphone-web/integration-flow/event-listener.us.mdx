# 5.	Listening to events and messages.

After IFRAME is included in the document, the next step is to add an event listener to the Window object.This will allow your application to start listening to the messages sent by the softphoneweb Iframe, enabling the control of important events related to the softphone connection.

The listener must be configured to capture three messages of messages:

- **disconnect** – This message is sent when a softphone disconnection occurs, for example, if the agent disconnects or the PBX connection is lost.
- **connect** – It indicates that the connection between the browser and the softphone was successfully made.
- **getUserMediaFail** – It signals that there was a failure when trying to gain access to the microphone, usually by lockout of the browser or absence of permission granted by the user.

The messages always come in the following format: “softPhoneResponse|*message_type*”

### Example:

-	softPhoneResponse|disconnect
-	softPhoneResponse|connect
-	softPhoneResponse|getUserMediaFail

Below is an example of how to add and treat this listener in JavaScript

```js
window.addEventListener("message", function (event) {
  if (typeof event.data === "string" && event.data.includes("softPhoneResponse|")) {
    const [, messageType] = event.data.split("|");

    switch (messageType) {
      case "disconnect":
        console.warn("Softphone disconnected.");
        break;
      case "connect":
        console.log("Successfully connected softphone.");
        break;
      case "getUserMediaFail":
        console.error("Failure when accessing the microphone.");
        break;
    }
  }
});
```